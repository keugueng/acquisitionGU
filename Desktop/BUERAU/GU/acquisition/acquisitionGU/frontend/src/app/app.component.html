<div class="app-container">
  <mat-sidenav-container *ngIf="authService.isAuthenticated()">
    <mat-sidenav #sidenav mode="side" opened>
      <div class="logo-container">
        <img src="assets/images/logo.png" alt="Logo MINHDU" />
      </div>

      <mat-nav-list>
        <a mat-list-item routerLink="/dashboard" routerLinkActive="active">
          <mat-icon>dashboard</mat-icon>
          <span>Tableau de bord</span>
        </a>

        <!-- Menu Gestion des Clients avec sous-menus -->
        <mat-expansion-panel class="mat-elevation-z0">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>people</mat-icon>
              <span>Gestion des Clients</span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-nav-list>
            <a mat-list-item routerLink="/clients" routerLinkActive="active">
              <mat-icon>list</mat-icon>
              <span>Liste des clients</span>
            </a>
            <a
              mat-list-item
              routerLink="/clients/new"
              routerLinkActive="active"
            >
              <mat-icon>person_add</mat-icon>
              <span>Nouveau client</span>
            </a>
            <a mat-list-item routerLink="/clients" routerLinkActive="active">
              <mat-icon>home_work</mat-icon>
              <span>Visites de logements</span>
            </a>
            <a mat-list-item routerLink="/clients" routerLinkActive="active">
              <mat-icon>folder_open</mat-icon>
              <span>Dossiers d'acquisition</span>
            </a>
          </mat-nav-list>
        </mat-expansion-panel>

        <!-- Menu Gestion des Logements -->
        <mat-expansion-panel class="mat-elevation-z0">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>apartment</mat-icon>
              <span>Gestion des Logements</span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-nav-list>
            <a
              mat-list-item
              routerLink="/logements/list"
              routerLinkActive="active"
            >
              <mat-icon>list</mat-icon>
              <span>Liste des logements</span>
            </a>
            <a
              mat-list-item
              routerLink="/logements/disponibles"
              routerLinkActive="active"
            >
              <mat-icon>check_circle</mat-icon>
              <span>Logements disponibles</span>
            </a>
          </mat-nav-list>
        </mat-expansion-panel>

        <!-- Menu Dossiers -->
        <mat-expansion-panel class="mat-elevation-z0">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>folder</mat-icon>
              <span>Dossiers</span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-nav-list>
            <a
              mat-list-item
              routerLink="/dossiers/list"
              routerLinkActive="active"
            >
              <mat-icon>list</mat-icon>
              <span>Liste des dossiers</span>
            </a>
            <a
              mat-list-item
              routerLink="/dossiers/en-cours"
              routerLinkActive="active"
            >
              <mat-icon>hourglass_empty</mat-icon>
              <span>Dossiers en cours</span>
            </a>
            <a
              mat-list-item
              routerLink="/dossiers/termines"
              routerLinkActive="active"
            >
              <mat-icon>check_circle</mat-icon>
              <span>Dossiers terminés</span>
            </a>
          </mat-nav-list>
        </mat-expansion-panel>

        <!-- Menu Gestion des Guichets -->
        <mat-expansion-panel class="mat-elevation-z0">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>desktop_windows</mat-icon>
              <span>Gestion des Guichets</span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-nav-list>
            <a
              mat-list-item
              routerLink="/guichets/list"
              routerLinkActive="active"
            >
              <mat-icon>list</mat-icon>
              <span>Liste des guichets</span>
            </a>
            <a
              mat-list-item
              routerLink="/guichets/agents"
              routerLinkActive="active"
            >
              <mat-icon>people</mat-icon>
              <span>Agents de guichet</span>
            </a>
          </mat-nav-list>
        </mat-expansion-panel>

        <!-- Menu Paramètres -->
        <mat-expansion-panel class="mat-elevation-z0">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>settings</mat-icon>
              <span>Paramètres</span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-nav-list>
            <a
              mat-list-item
              routerLink="/parametres/profil"
              routerLinkActive="active"
            >
              <mat-icon>person</mat-icon>
              <span>Mon profil</span>
            </a>
            <a
              mat-list-item
              routerLink="/parametres/utilisateurs"
              routerLinkActive="active"
            >
              <mat-icon>group</mat-icon>
              <span>Gestion des utilisateurs</span>
            </a>
          </mat-nav-list>
        </mat-expansion-panel>
      </mat-nav-list>
    </mat-sidenav>

    <mat-sidenav-content>
      <mat-toolbar color="primary">
        <button mat-icon-button (click)="sidenav.toggle()" class="menu-toggle">
          <mat-icon>menu</mat-icon>
        </button>
        <span class="toolbar-title">{{ pageTitle }}</span>
        <span class="toolbar-spacer"></span>
        <button mat-icon-button [matMenuTriggerFor]="notificationMenu">
          <mat-icon [matBadge]="notifications.length" matBadgeColor="warn"
            >notifications</mat-icon
          >
        </button>
        <mat-menu #notificationMenu="matMenu">
          <div class="notification-header">
            <h3>Notifications</h3>
            <button mat-button color="primary">Tout marquer comme lu</button>
          </div>
          <mat-divider></mat-divider>
          <div class="notification-list">
            <div
              *ngFor="let notification of notifications"
              class="notification-item"
            >
              <mat-icon [ngClass]="notification.type">{{
                notification.icon
              }}</mat-icon>
              <div class="notification-content">
                <p>{{ notification.message }}</p>
                <small>{{ notification.date | date : "short" }}</small>
              </div>
            </div>
          </div>
          <mat-divider></mat-divider>
          <div class="notification-footer">
            <button mat-button color="primary">
              Voir toutes les notifications
            </button>
          </div>
        </mat-menu>

        <button mat-icon-button [matMenuTriggerFor]="userMenu">
          <img [src]="userAvatar" alt="User Avatar" class="user-avatar" />
        </button>
        <mat-menu #userMenu="matMenu">
          <div class="user-menu-header">
            <img
              [src]="userAvatar"
              alt="User Avatar"
              class="user-avatar-large"
            />
            <div class="user-info">
              <h3>{{ userName }}</h3>
              <p>{{ currentGuichet }}</p>
            </div>
          </div>
          <mat-divider></mat-divider>
          <button mat-menu-item routerLink="/parametres/profil">
            <mat-icon>person</mat-icon>
            <span>Mon profil</span>
          </button>
          <button mat-menu-item (click)="logout()">
            <mat-icon>exit_to_app</mat-icon>
            <span>Déconnexion</span>
          </button>
        </mat-menu>
      </mat-toolbar>

      <div class="content-container">
        <router-outlet></router-outlet>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>

  <!-- Affichage pour les utilisateurs non authentifiés -->
  <div *ngIf="!authService.isAuthenticated()" class="auth-container">
    <router-outlet></router-outlet>
  </div>
</div>
